---















import { getCollection } from "astro:content";
import { Star, Zap } from "lucide-react";
import { Badge } from "@/components/ui/8bit/badge";
import { Card, CardContent } from "@/components/ui/8bit/card";
import { PixelFooter } from "@/components/ui/8bit/pixel-footer";
import PixelNav from "@/components/ui/8bit/pixel-nav";
import PixelPagination from "@/components/ui/8bit/pixel-pagination";
import { ThemeToggle } from "@/components/ui/8bit/theme-toggle";
import MainLayout from "../../../layouts/main.astro";

export async function getStaticPaths({ paginate }) {
	const profiles = await getCollection("profiles");

	// Sort: featured first, then by order
	const sortedProfiles = profiles.sort((a, b) => {
		if (a.data.featured && !b.data.featured) return -1;
		if (!a.data.featured && b.data.featured) return 1;
		return (a.data.order || 999) - (b.data.order || 999);
	});

	return paginate(sortedProfiles, { pageSize: 12 });
}

const { page } = Astro.props;
const profiles = page.data;
---

<MainLayout content={{ title: "Chattinisona - Profiles" }}>
	<PixelNav current="profiles" client:load />

	<main class="min-h-screen bg-dots relative py-8 px-4 pt-24" transition:animate="fade">
		<div class="max-w-7xl mx-auto">
			<header class="text-center mb-12">
				<div class="inline-block bg-primary border-4 border-foreground p-1 mb-6 shadow-[8px_8px_0px_0px_hsl(var(--foreground))]">
					<div class="bg-background border-2 border-dashed border-primary px-8 py-4">
						<h1 class="retro text-3xl md:text-5xl text-primary uppercase tracking-wider">
							Chattinisona
						</h1>
					</div>
				</div>
				<p class="text-lg md:text-xl text-muted-foreground max-w-2xl mx-auto font-medium">
					<span class="text-accent">▸</span> Meet the legendary Chattini heroes <span class="text-accent">◂</span>
				</p>
			</header>

			<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-12">
				{profiles.map((profile) => {
					const imageSrc = profile.data.image
						? `/images/profiles/${profile.data.image}`
						: '/images/profiles/chattino.jpeg';
					const isFeatured = profile.data.featured;

					return (
						<a
							href={`/profiles/${profile.id}`}
							class="group block transition-transform hover:-translate-y-1"
						>
							<Card className="h-full border-4 border-foreground shadow-[4px_4px_0px_0px_hsl(var(--foreground))] hover:shadow-[6px_6px_0px_0px_hsl(var(--accent))] transition-all bg-gradient-to-br from-background to-secondary/20">
								<CardContent className="p-0">
									<div class="relative bg-secondary dark:bg-slate-800 border-b-4 border-foreground p-3">
										{isFeatured && (
											<div class="absolute top-2 left-2 z-10">
												<Badge className="bg-accent border-2 border-foreground text-accent-foreground retro text-[8px] px-2 py-1 shadow-[2px_2px_0px_0px_hsl(var(--foreground))]">
													<Star className="w-3 h-3 mr-1 inline" />
													FEATURED
												</Badge>
											</div>
										)}

										<div class="aspect-square bg-background border-4 border-foreground overflow-hidden relative group">
											<img
												src={imageSrc}
												alt={profile.data.name}
												class="w-full h-full object-cover pixel-art grayscale group-hover:grayscale-0 transition-all duration-300"
												loading="lazy"
											/>
											<div class="absolute inset-0 bg-gradient-to-b from-transparent via-primary/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity crt-scanlines pointer-events-none"></div>
										</div>
									</div>

									<div class="p-4 space-y-3">
										<h2 class="retro text-sm text-primary uppercase text-center line-clamp-1">
											{profile.data.name}
										</h2>

										<div class="bg-primary/10 dark:bg-primary/20 border-2 border-primary/30 p-2 text-center">
											<p class="text-xs font-bold text-primary uppercase">
												{profile.data.class}
											</p>
										</div>

										<div class="flex justify-between items-center text-xs pt-2 border-t-2 border-dotted border-muted">
											<div class="flex items-center gap-1">
												<Zap className="w-3 h-3 text-accent" />
												<span class="retro text-[10px] text-accent">LV {profile.data.stats.level}</span>
											</div>
											{profile.data.stats.cuteness && (
												<div class="flex items-center gap-1">
													<span class="retro text-[10px] text-pink-500">♥</span>
													<span class="text-[10px] font-bold text-muted-foreground">{profile.data.stats.cuteness}%</span>
												</div>
											)}
										</div>
									</div>
								</CardContent>
							</Card>
						</a>
					);
				})}
			</div>

			{page.lastPage > 1 && (
				<div class="flex justify-center mt-8">
					<PixelPagination
						client:load
						currentPage={page.currentPage}
						totalPages={page.lastPage}
						baseUrl="/profiles/page/"
					/>
				</div>
			)}

			<div class="mt-16">
				<PixelFooter />
			</div>
		</div>

		<ThemeToggle client:only="react" />
	</main>
</MainLayout>

<style>
	.line-clamp-1 {
		overflow: hidden;
		display: -webkit-box;
		-webkit-box-orient: vertical;
		-webkit-line-clamp: 1;
	}
</style>
